@page
@model JDWordSearchApp.Pages.WordSearches.IndexModel

@{
    ViewData["Title"] = "Index";
}

<h1>JD's Word Search C# APP</h1>

<h3>Create a Word Search App Below!</h3>
<br />
<br />
<br />
<div class="container p-5 align-content-center">
    <form action="post" id="wordForm">
        <div class="mb-3">
            <label class="my-1 me-2" for="dimensions">Enter Word Search Dimensions</label>
            <input name="dimensions" id="dimensions" type="number" class="form-control" />
            <small id="wordSearchDimHelp" class="form-text text-muted">Only 1 number is required, as the Word Search will be a square</small>
            <p id="dimcheck" style="color: red;">Please enter only a number</p>
        </div>
        <div class="input-group mb-3">
            <label class="my-1 me-2" for="words">Enter Words you would like to use</label>
            <input name="words" id="words" type="text" class="form-control"  />
            <button id="AddWord" class="btn btn-info">Add Word</button>
            <p id="wordcheck" style="color: red;">Word length must be less than the dimensions you set</p>
        </div>
        <br />
        <div class="col text-center">
            <button id="submit" class="btn btn-primary">Generate Word Search</button>
        </div>
    </form>
</div>
<div class="align-content-between">
    <h6 id="dimNumber"></h6>
    <ul id="wordsChosen" style="float: right;"></ul>
</div>
<div class="container">
    <div class="col text-center">
        <button id="regen" class="btn btn-primary mb-3">Remake Word Search</button>
    </div>
    <div class="row">
        <div id="wordgame" class="col-6"></div>
        <div class="col-6 bg-info" id="listContain" style="border-radius: 20px; padding: 10px;">
            <h3 class="col text-center">Solutions</h3>
            <ul id="wordList"></ul>
        </div>
    </div>
</div>

@section scripts{
    <script>
        $(document).ready(function () {
            $('#dimcheck').hide();
            $('#wordcheck').hide();
            $('#regen').hide();
            $('#listContain').hide();
            let dimError = true;
            let wordError = true;

            var wordArr = new Array();

            $(function () {
                $('#dimensions').on('focusout', function () {
                    var dim = parseInt($("#dimensions").val());
                    if (isNaN(dim)) {
                        $('#dimcheck').show();
                        dimError = false;
                        return false;
                    } else {
                        $('#dimcheck').hide();
                        $("#dimNumber").text(dim);
                        dimError = true;
                    }
                });
            });
            $(function () {
                $('#AddWord').on('click', function (e) {
                    var dim = parseInt($('#dimensions').val());
                    var word = $("#words").val();
                    if(word.length > dim ) {
                        $('#wordcheck').show();
                        wordError = false;
                        return false;
                    } else {
                        e.preventDefault();
                        $("#wordsChosen").prepend('<li>' + word + '</li>');
                        $('input[type="text"]').val("");
                        $('#wordcheck').hide();
                        wordError = true;
                    }
                    
                });
            });
            $(function () {
                $('#submit').on('click', function (e) {
                    if (dimError == true && wordError == true ) {
                        e.preventDefault();
                        var dim = parseInt($("#dimensions").val());
                        var listItems = $("#wordsChosen li");
                        listItems.each(function(idx, li) {
                            var word = $(li).text();
                            console.log(word);
                            wordArr[idx] = word.toUpperCase();
                        });
                        var wordData = { dims: dim, words: wordArr };
                        console.log(wordData);
                        $.ajax({
                            url: "/WordSearches/Index?handler=Partial",
                            type: 'GET',
                            data: wordData,
                            traditional: true
                        }).done(function(result) {
                            $('#wordgame').html(result);
                        });
                        $('#submit').hide();
                        $('#regen').show();
                        $('#dimNumber').hide();
                        $('#wordsChosen').hide();
                        $('#wordForm').hide();
                        $('#listContain').show();
                        for (var i = 0; i < wordArr.length; i++) {
                            $("#wordList").prepend('<li>' + wordArr[i] + '</li>');
                        }
                    }
                    else {
                        alert('Please make sure your fields are valid');
                    }
                });
            });
            $(function () {
                $('#regen').on('click', function (e) {
                    if (dimError == true && wordError == true) {
                        e.preventDefault();
                        var dim = parseInt($("#dimensions").val());
                        var wordData = { dims: dim, words: wordArr };
                        console.log(wordData);
                        $.ajax({
                            url: "/WordSearches/Index?handler=Partial",
                            type: 'GET',
                            data: wordData,
                            traditional: true
                        }).done(function (result) {
                            $('#wordgame').html(result);
                        });
                    }
                    else {
                        alert('Please make sure your fields are valid');
                    }
                });
            });
        });
    </script>

}